---
title: 'hspin: A Python package for first-principles calculation of zero field splitting tensor'
tags:
  - materials science
  - electron spin
  - zero field splitting
  - density functional theory
  - point defects
authors:
  - name: He Ma
    orcid: 1
    affiliation: "1, 2"
  - name: Marco Govoni
    orcid: 1
    affiliation: 3
  - name: Giulia Galli
    orcid: 1
    affiliation: "1, 2, 3"
affiliations:
 - name: Department of Chemistry, University of Chicago, Chicago, IL 60637, USA
   index: 1
 - name: Pritzker School of Molecular Engineering, University of Chicago, Chicago, IL 60637, USA
   index: 2
 - name: aterials Science Division and Center for Molecular Engineering, Argonne National Laboratory, Lemont, IL 60439, USA
   index: 3
date: 06 February 2020
bibliography: paper.bib
---

# Summary
Electron spins in molecules and materials are important resources for information storage and quantum technologies. The low energy physics of electron spins can be described by spin Hamiltonians, which characterize the interactions between electron spins and between electrons spins and external environment. For a system with effective electron spin $S \geq 1$ under no magnetic and hyperfine field, the spin Hamiltonian assumes the following form
$$ H_\mathrm{spin} = \mathbf{S} \cdot \mathbf{D} \cdot \mathbf{S} $$
where $\mathbf{S}$ is the spin operator and $\mathbf{D}$ denotes the zero field splitting (ZFS) tensor. Physically, the ZFS tensor originates from magnetic spin-spin interactions and spin-orbit interactions. For systems without heavy elements, in particular main group point defects in semiconductors, the spin-spin component is usually dominant. The ZFS tensor determines the energy splitting of spin sublevels without external fields and is an important property for open-shell molecules and spin defects in semiconductors with $S \geq 1$.

`hspin` is an MPI-parallelized Python code for the first-principles calculation of spin-spin ZFS tensor based on wavefunctions obtained from density functional theory (DFT) calculations. The spin-spin ZFS tensor can be represented as an expectation value of dipole-dipole interactions on the DFT Kohn-Sham orbitals
$$ D_{ab} = \frac{1}{2} \frac{1}{S(2S-1)} \frac{\mu_0}{4\pi} (\gamma_\text{e} \hbar)^2 \ \sum_{i \le j}^{\text{occ.}} \chi_{ij} \langle \Phi_{ij}| \  \frac{ r^2\delta_{ab} - 3r_a r_b }{ r^5 } \  |\Phi_{ij} \rangle $$
where $a, b = x, y, z$ are Cartesian indices; $\gamma_e$ is the gyromagnetic ratio of electron; the summation is taken over all pairs of occupied Kohn-Sham orbitals; $\chi_{ij} = \pm 1$ for parallel and antiparallel spins respectively; $\Phi_{ij}(\textbf{r},\textbf{r}')$ are $2 \times 2$ determinants formed from orbitals $\phi_{i}$ and $\phi_{j}$, $\Phi_{ij}(\textbf{r},\textbf{r}')=\frac{1}{\sqrt{2}}\Big[\phi_{i}(\textbf{r})\phi_{j}(\textbf{r}') - \phi_{i}(\textbf{r}')\phi_{j}(\textbf{r})]$. `hspin` adopts the numerical formalism proposed in [@Rayson:2008] to evaluate the above expression on plane-wave basis, which utilize Fourier Transform to reduce the double integrations in real space into a single summation over reciprocal lattice vectors.

We note that large-scale DFT calculations can yield wavefunction files larger than 50 GB or even 100 GB. Therefore, proper distribution and management of data is critical. In `hspin`, the summation over pairs of Kohn-Sham orbitals is distributed into a square grid of processors, which significantly reduce the CPU time and memory cost per processor. `hspin` also implements different memory management modes, which controlls whether intermediate quantities are kept in memory for reuse or recomputed every time, allowing the user to balance the computational time and memory cost.

`hspin` can work with wavefunctions generated by various plane-wave DFT codes. For instance, `hspin` can directly read DFT wavefunctions from `Quantum Espresso` [@Giannozzi:2009] in the HDF5 format and wavefunction from `Qbox` [@Gygi:2008] in the XML format. The standard cube file format is also supported. `hspin` features a modular design and utilizes abstract classes for extensitivity. Support for new wavefunction format can be easily implemented by defining subclasses of the relevant abstract class and overriding corresponding abstract methods.

Since its development, `hspin` has been adopted by several works to predict ZFS tensors for spin defects in semiconductors, and facilitated exciting progresses in the discovery of novel spin defects [@Seo:2017] and the coherence control of defect spins in crystals [@Whiteley:2019]. `hspin` has also been adopted to generate benchmark data in plane-wave basis for the development of methods to compute the ZFS tensor in other numerical basis [@Ghosh:2019]. Thanks to the parallel design of the code, `hspin` can perform calculations for defects embedded in large supercells. The calculations performed in [@Whiteley:2019] used supercells that contain more than 3000 valence electrons, and are among the largest first-principles calculations of ZFS tensors reported by the time this document is written. 

# Acknowledgements
We thank Hosung Seo for helpful discussions. 
This work was supported by MICCoM, as part of the Computational Materials Sciences Program funded by the U.S. Department of Energy, Office of Science, Basic Energy Sciences, Materials Sciences and Engineering Division through Argonne National Laboratory, under contract number DE-AC02-06CH11357.
This research used computational resources of the University of Chicago Research Computing Center.

# References

